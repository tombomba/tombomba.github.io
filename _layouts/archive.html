---
layout: default
style: page
---

{% comment -%}
  !! Cobble together a datestring based on front matter permalink /:year/:month/ !!
  !! shift removes dead space at the start of array (caused by initial permalink slash) !!
{% endcomment -%}
{% assign rawdate = page.permalink | split: '/' | shift -%}

{% assign page_year = rawdate[0] -%}
{% assign page_month = rawdate[1] -%}

{% if page_month and page_month !='' and page_month != nil -%}
  {% assign is_month_index = true -%}
  {% assign title_string = rawdate | push: '01' | join: '-' | date: '%B %Y' -%}
{% else -%}
  {% assign is_year_index = true -%}
  {% assign title_string = page_year -%}
{% endif -%}

<article>{% if page.date %}<!-- {{ page.date }} -->{% endif %}

  <header>
    <h1>{{ page.title }}</h1>
  </header>

  {% if is_month_index %}
  <ul class="toc norm">
  {% else %}
  <ul class="toc">
  {% endif -%}
  {% for p in site.posts -%}
    {% assign t = p.title | default: 'Empty?!' | strip | normalize_whitespace | smartify | split: ' ' -%}
    {% assign sub = t.last | prepend: '!QQ!' -%}
    {% assign titlef = t | pop | push: sub | join: ' ' | replace: ' !QQ!', '&nbsp;' -%}
    {% assign current_month = p.date | date: "%m" -%}
    {% assign current_year = p.date | date: "%Y" -%}
    {% if is_month_index and current_month == page_month and current_year == page_year -%}
    <li>
      <h2><a href="{{ p.url | prepend: site.url }}" class="{{ iconstyle }}">{{ titlef }}</a></h2>
      <p>{{ p.excerpt | strip_html | normalize_whitespace | smartify }}</p>
    </li>
    {% elsif is_year_index and current_year == page_year -%}
    <li>
      <h2><a href="{{ p.url | prepend: site.url }}" class="{{ iconstyle }}">{{ titlef }}</a></h2>
      <p>{{ p.fbog.text | default: p.excerpt | strip_html | normalize_whitespace | smartify }}{% comment %} {% if p.date %}<span class="dates">({{ p.date | date: "%-d %b" }})</span>{% endif %}{% endcomment %}</p>
    </li>
    {% endif -%}
  {% endfor -%}
  </ul>

</article>
