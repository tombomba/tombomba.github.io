{% assign p = include.page %}
{% assign copy = include.content | strip | normalize_whitespace -%}
{% assign wordcount = copy | number_of_words %}

{% if p.media or wordcount < 150 %}
  {% assign hedsize = 'sm' %}
  {% include _puncf.html title=p.title %}
{% else %}
  {% assign hedsize = 'md' %}
  {% include _titlef.html title=p.title %}
{% endif %}

<article><!-- {{ p.layout }}: {{ copy | number_of_words }} -->

  {% if p.media %}
    {% include figure.html media=p.media %}
  {% endif %}

  {% capture hedbox %}
    <header class="{{ hedsize | default: 'sm' }}">
      <h1>
      {% if include.is_home %}<a href="{{ p.url | absolute_url }}">{{ titlef }}</a>{% else %}{{ titlef }}{% endif %}
      </h1>
      <p>
  {% endcapture %}

  {% assign copy = copy | replace_first: '</p>', '</p></header>' | replace_first: '<p>', hedbox %}
  {{ copy | strip | normalize_whitespace }}

</article>